<!doctype html>
<html>
  
  <head>
    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <script src='sketch.js'></script>
    <script src="channel/bcsocket.js"></script>
    <script src="share/share.js"></script>
    <script src="share/json.js"></script>
    <script>
      sketchjs($);
    
      $(function() {
        sketch = $('#simple_sketch').sketch();
    
        var getUrlParameter = function (name) {
            return (new RegExp(name + '=' + '(.+?)(&|$)').exec(window.location.search)||[,null])[1];
        };

        var ws = new WebSocket('ws://127.0.0.1:8080');
        var share = new sharejs.Connection(ws);

        var doc = share.get('docs', getUrlParameter('doc'));
        doc.subscribe();

        doc.whenReady(function () {
          if (!doc.type)
            doc.create('json', []);
          
          doc.on('change', function(op) {
            sketch.setShapes(doc.snapshot);
          });
          
          sketch.on('change', function(){
            doc.set(sketch.getShapes());
          });
        });
      });
    </script>
  </head>
  
  <body>
    <canvas id='simple_sketch' width='400' height='400' style='border: 2px solid black'></canvas>
  </body>

</html>